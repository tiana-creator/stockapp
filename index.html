<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Stock Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap");
      body {
        font-family: "Noto Sans TC", sans-serif;
        background-color: #f8f9fd;
      }
      .active-tab {
        color: #4f46e5;
      }
      .hidden {
        display: none;
      }
      #main-content {
        height: calc(100vh - 80px);
        overflow-y: auto;
      }
      #main-content::-webkit-scrollbar {
        display: none;
      }
      /* æ¨¡ä»¿èˆŠç‰ˆè¼¸å…¥æ¡†æ¨£å¼ */
      .input-style {
        background-color: #f8fafc;
        border: 1px solid #f1f5f9;
        padding: 1rem;
        border-radius: 1rem;
        width: 100%;
        outline: none;
        font-size: 0.875rem;
        transition: all 0.2s;
      }
      .input-style:focus {
        border-color: #e2e8f0;
        background-color: #ffffff;
      }
      .label-style {
        font-size: 0.75rem;
        font-weight: 700;
        color: #64748b;
        margin-bottom: 0.25rem;
        display: block;
        padding-left: 0.25rem;
      }
    </style>
  </head>
  <body class="text-slate-900">
    <div
      class="max-w-md mx-auto bg-white min-h-screen flex flex-col relative shadow-xl"
    >
      <div
        class="px-6 py-5 flex justify-between items-center bg-white sticky top-0 z-20"
      >
        <h1
          id="page-title"
          class="font-black text-slate-800 text-xl tracking-tight"
        >
          æ–°å¢äº¤æ˜“
        </h1>
        <button
          onclick="fetchData()"
          id="refresh-btn"
          class="hidden text-xs bg-slate-100 text-slate-500 px-3 py-1.5 rounded-full active:scale-95 transition-all"
        >
          ğŸ”„ åˆ·æ–°
        </button>
      </div>

      <div id="main-content" class="flex-1 px-6">
        <div id="page-form" class="py-2 space-y-6">
          <div>
            <label class="label-style">æˆäº¤æ™‚é–“</label>
            <input
              type="text"
              id="time"
              readonly
              class="input-style text-slate-400 font-medium"
            />
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="label-style">è‚¡ç¥¨ä»£è™Ÿ</label>
              <input
                type="text"
                id="stockId"
                placeholder="ä¾‹å¦‚ï¼š00952"
                class="input-style font-bold"
              />
            </div>
            <div>
              <label class="label-style">è‚¡ç¥¨åç¨±</label>
              <input
                type="text"
                id="stockName"
                placeholder="ä¾‹å¦‚ï¼šå‡±åŸºå°ç£AI50"
                class="input-style font-bold"
              />
            </div>
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="label-style">æˆæœ¬åƒ¹</label>
              <input
                type="number"
                id="price"
                oninput="calc()"
                placeholder="0.00"
                class="input-style"
              />
            </div>
            <div>
              <label class="label-style">äº¤æ˜“è‚¡æ•¸</label>
              <input
                type="number"
                id="shares"
                oninput="calc()"
                placeholder="1000"
                class="input-style"
              />
            </div>
          </div>

          <div
            class="bg-[#EEF2FF] p-6 rounded-2xl flex justify-between items-center mt-4"
          >
            <span class="text-[#4338CA] font-bold text-sm">ç¸½è¨ˆé‡‘é¡</span>
            <span id="totalDisplay" class="text-2xl font-black text-[#1E1B4B]"
              >$ 0</span
            >
          </div>

          <button
            onclick="submitData()"
            id="btn"
            class="w-full bg-[#4338CA] text-white py-4 rounded-2xl font-bold text-base shadow-lg shadow-indigo-100 active:scale-[0.98] transition-all"
          >
            å‚³é€äº¤æ˜“ç´€éŒ„
          </button>
          <p
            id="status"
            class="text-center text-xs font-bold text-slate-300"
          ></p>
        </div>

        <div id="page-list" class="hidden py-2">
          <div id="dataContainer"></div>
        </div>
      </div>

      <div
        class="h-[80px] bg-white border-t flex items-center justify-around px-10 pb-4 sticky bottom-0"
      >
        <button
          onclick="showPage('form')"
          id="tab-form"
          class="flex flex-col items-center gap-1 active-tab transition-all"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2.5"
              d="M12 4v16m8-8H4"
            />
          </svg>
          <span class="text-[10px] font-bold">æ–°å¢äº¤æ˜“</span>
        </button>
        <button
          onclick="showPage('list')"
          id="tab-list"
          class="flex flex-col items-center gap-1 text-slate-300 transition-all"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2.5"
              d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
            />
          </svg>
          <span class="text-[10px] font-bold">æ­·å²ç´€éŒ„</span>
        </button>
      </div>
    </div>

    <script>
      const SCRIPT_URL =
        "https://script.google.com/macros/s/AKfycbxIEAik4knfvK3aLbPDYRadylqYMLR73d5mTlpKlIN62eGJEVUF9lBwvO_RYAsOallC6w/exec";

      function showPage(page) {
        document
          .getElementById("page-form")
          .classList.toggle("hidden", page !== "form");
        document
          .getElementById("page-list")
          .classList.toggle("hidden", page !== "list");
        document
          .getElementById("tab-form")
          .classList.toggle("active-tab", page === "form");
        document
          .getElementById("tab-list")
          .classList.toggle("active-tab", page === "list");
        document
          .getElementById("tab-form")
          .classList.toggle("text-slate-300", page !== "form");
        document
          .getElementById("tab-list")
          .classList.toggle("text-slate-300", page !== "list");
        document.getElementById("page-title").innerText =
          page === "form" ? "æ–°å¢äº¤æ˜“" : "æœ€è¿‘æˆäº¤é …ç›®";
        document
          .getElementById("refresh-btn")
          .classList.toggle("hidden", page !== "list");
        if (page === "list") fetchData();
      }

      function updateTime() {
        const now = new Date();
        // çµ±ä¸€æ ¼å¼åŒ–ï¼š2026/01/16 13:45:53
        const formatted =
          now.getFullYear() +
          "/" +
          (now.getMonth() + 1).toString().padStart(2, "0") +
          "/" +
          now.getDate().toString().padStart(2, "0") +
          " " +
          now.getHours().toString().padStart(2, "0") +
          ":" +
          now.getMinutes().toString().padStart(2, "0") +
          ":" +
          now.getSeconds().toString().padStart(2, "0");
        document.getElementById("time").value = formatted;
      }
      setInterval(updateTime, 1000);
      updateTime();

      function calc() {
        const p = document.getElementById("price").value || 0;
        const s = document.getElementById("shares").value || 0;
        document.getElementById("totalDisplay").innerText =
          "$ " + Math.round(p * s).toLocaleString();
      }

      async function submitData() {
        const btn = document.getElementById("btn");
        const data = {
          time: document.getElementById("time").value,
          stockId: document.getElementById("stockId").value,
          stockName: document.getElementById("stockName").value,
          price: document.getElementById("price").value,
          shares: document.getElementById("shares").value,
          total: Math.round(
            document.getElementById("price").value *
              document.getElementById("shares").value
          ),
        };
        if (!data.stockId || !data.price) return alert("è«‹å¡«å¯«å¿…è¦è³‡è¨Š");
        btn.disabled = true;
        btn.innerText = "æ­£åœ¨å‚³é€...";
        try {
          await fetch(SCRIPT_URL, {
            method: "POST",
            mode: "no-cors",
            body: JSON.stringify(data),
          });
          ["stockId", "stockName", "price", "shares"].forEach(
            (id) => (document.getElementById(id).value = "")
          );
          document.getElementById("totalDisplay").innerText = "$ 0";
          document.getElementById("status").innerText = "å·²æˆåŠŸå‚³é€è‡³é›²ç«¯";
          setTimeout(
            () => (document.getElementById("status").innerText = ""),
            3000
          );
        } catch (e) {
          alert("å‚³é€å¤±æ•—");
        } finally {
          btn.disabled = false;
          btn.innerText = "å‚³é€äº¤æ˜“ç´€éŒ„";
        }
      }

      async function fetchData() {
        const container = document.getElementById("dataContainer");
        container.innerHTML =
          '<div class="text-center py-20 text-slate-300 text-sm font-bold animate-pulse">è®€å–ä¸­...</div>';

        try {
          const response = await fetch(SCRIPT_URL);
          const data = await response.json();
          container.innerHTML = "";

          const groups = {};
          data.forEach((item) => {
            // å¼·åˆ¶æˆªæ–·æ™‚é–“ï¼Œåªå– YYYY/MM/DD
            const d = new Date(item.time);
            const dateKey = `${d.getFullYear()}/${(d.getMonth() + 1)
              .toString()
              .padStart(2, "0")}/${d.getDate().toString().padStart(2, "0")}`;

            if (!groups[dateKey]) {
              groups[dateKey] = { items: [], dayTotal: 0 };
            }
            groups[dateKey].items.push(item);
            groups[dateKey].dayTotal += Number(item.total);
          });

          const sortedDates = Object.keys(groups).sort(
            (a, b) => new Date(b) - new Date(a)
          );

          sortedDates.forEach((date) => {
            const group = groups[date];
            container.innerHTML += `
                        <div class="flex items-center gap-3 py-6 px-1">
                            <div class="flex-grow border-t border-dashed border-slate-200"></div>
                            <div class="text-[11px] font-black text-slate-800 tracking-tighter uppercase">
                                ${date} &nbsp; ç¸½é‡‘é¡: ${group.dayTotal.toLocaleString()}
                            </div>
                            <div class="flex-grow border-t border-dashed border-slate-200"></div>
                        </div>`;

            group.items
              .slice()
              .reverse()
              .forEach((item) => {
                container.innerHTML += `
                            <div class="bg-white border border-slate-50 rounded-[1.25rem] p-5 shadow-[0_4px_15px_rgba(0,0,0,0.02)] mb-4">
                                <div class="flex justify-between items-center">
                                    <div class="space-y-1">
                                        <div class="flex items-center gap-2">
                                            <span class="text-lg font-black text-slate-800 tracking-tighter">${
                                              item.stockId
                                            }</span>
                                            <span class="text-[9px] font-black bg-slate-100 text-slate-400 px-2 py-0.5 rounded-md">${
                                              item.stockName
                                            }</span>
                                        </div>
                                        <div class="text-[9px] text-slate-300 font-bold">${
                                          item.time
                                        }</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-[#4F46E5] font-black text-xl tracking-tighter">$${Number(
                                          item.total
                                        ).toLocaleString()}</div>
                                        <div class="text-[10px] text-slate-400 font-bold">${Number(
                                          item.price
                                        ).toLocaleString()} x ${Number(
                  item.shares
                ).toLocaleString()}</div>
                                    </div>
                                </div>
                            </div>`;
              });
          });
        } catch (e) {
          container.innerHTML =
            '<div class="text-center py-20 text-red-300 text-xs font-bold">è®€å–å¤±æ•—</div>';
        }
      }
    </script>
  </body>
</html>
